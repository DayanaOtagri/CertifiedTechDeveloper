-- ================= BASE DE DATOS I - PROYECTO - EL DESCUBIERTO ================= --
-- =============================== CHECKPOINT III ================================ --
-- Base de datos: el_descubierto
-- Camada N°: 0921TDBD1N1C7LAED0621PT
-- Equipo N°:
-- Integrantes: 


-- 1. Listar todos los clientes que tengan tres o más cuentas bancarias. Mostrar el número de cliente, apellido y nombre separado por un espacio dentro de una misma columna denominada "Cliente" y, la cantidad de cuentas que posee.
-- Cantidad de registros devueltos (rows): 

-- 2. Listar todos los clientes que no tengan una cuenta bancaria. Mostrar el número de cliente, apellido y nombre en mayúsculas dentro de una misma columna denominada "Cliente sin cuenta bancaria".
-- Cantidad de registros devueltos (rows): 

-- 3. Listar todos los clientes que tengan al menos un préstamo que corresponda a la sucursal de la ciudad de "Pilar - Buenos Aires". Se debe mostrar el número de cliente, apellido, nombre, número de préstamo, número de sucursal, nombre de la ciudad y país de dicha sucursal.
-- Cantidad de registros devueltos (rows): 

-- 4. Listar los clientes que tengan una o más cajas de ahorro y que en la segunda letra de su apellido contenga una "e".
-- Cantidad de registros devueltos (rows): 

-- 5. Listar absolutamente todos los países y la cantidad de clientes que tengan.
-- Cantidad de registros devueltos (rows): 

-- 6. Calcular el importe total y la cantidad de préstamos otorgados en el mes de agosto por cada cliente. Mostrar el número de cliente, importe total y cantidad de préstamos.
-- Cantidad de registros devueltos (rows): 

-- 7. Calcular el importe total y la cantidad de cuotas pagadas para el préstamo número cuarenta. 
-- Cantidad de registros devueltos (rows): 

-- 8. Determinar el importe restante que falta por pagar para el préstamo número 45.
-- Cantidad de registros devueltos (rows): 

-- 9. Listar los préstamos de la sucursal número cuatro. Mostrar el número de cliente, apellido, nombre y el número de préstamo.
-- Cantidad de registros devueltos (rows): 

-- 10. Reportar el número del préstamo y la cantidad de cuotas pagadas por cada uno préstamo. Se debe formatear el dato de la cantidad de cuotas pagadas, por ejemplo, si se ha pagado una cuota, sería "1 cuota paga"; si se han pagado dos o más cuotas, sería en plural "2 cuotas pagas" y "Ninguna cuota paga" para los préstamos que aún no han recibido un pago.
-- Cantidad de registros devueltos (rows): 

SELECT id, cantidad_cuota,
CASE 
  WHEN cantidad_cuota = 1 THEN "Se ha pagado una cuota"
  WHEN cantidad_cuota > 1 THEN "Se han pagado dos cuotas o más"
  ELSE "Ninguna cuota pagada"
  END AS pagoCuotas
FROM prestamo;
 
 -- LIMIT 0, 1000	47 row(s) returned	0.000 sec / 0.000 sec 

-- 11. Listar absolutamente todos los empleados y las cuentas bancarias que tengan asociada. Mostrar en una sola columna el apellido y la letra inicial del nombre del empleado (Ej. Tello Aguilera C.), en otra columna, el número de cuenta y el tipo (Ej. 10560 - CAJA DE AHORRO). Los campos nulos deben figurar con la leyenda "-Sin asignación-".
-- Cantidad de registros devueltos (rows): 

SELECT CONCAT(e.apellido, " ", e.nombre) nombreEmpleado, concat(c.numero, " - ", ct.tipo ) cuentaTipo
FROM empleado e
LEFT JOIN cuenta c
ON legajo = ejecutivo_cuenta 
LEFT JOIN cuenta_tipo ct
ON  cuenta_tipo_id = id;



-- 12. Reportar todos los datos de los clientes y los números de cuenta que tienen.

SELECT *
FROM cliente  c
INNER JOIN cliente_x_cuenta
ON c.id = cliente_id;


-- 13. Listar los clientes con residencia en las ciudades de "Las Heras - Mendoza", "Viña del Mar - Valparaíso", "Córdoba - Córdoba" y "Monroe - Buenos Aires". Se debe mostrar el apellido, nombre del cliente y todos los datos referidos a la ciudad 
-- Cantidad de registros devueltos (rows): 

SELECT cl.nombre, cl.apellido, cu.nombre, cu.id, cu.codigo_postal
FROM cliente cl
INNER JOIN ciudad cu 
ON ciudad_id = cu.id


-- 14. Listar los clientes que tienen préstamos otorgados entre 15/08/21 al 5/09/21 (ordenarlos por fecha de otorgamiento). Mostrar sólo el email del cliente, teléfono móvil y todos los datos referidos al préstamo.
-- Cantidad de registros devueltos (rows): 

-- 15. Listar de manera ordenada, los empleados que no pertenezcan a la sucursal de la ciudad "Monroe - Buenos Aires" y que la fecha de alta del contrato se halle dentro del rango 2016 al 2018. Mostrar el email del empleado, número de sucursal y el nombre de la ciudad
-- Cantidad de registros devueltos (rows): 

-- 16. Listar las cuentas bancarias que tienen dos titulares. Mostrar sólo el número de cuenta y la cantidad de titulares
-- Cantidad de registros devueltos (rows): 

-- 17. Se desea conocer el segundo pago con mayor importe efectuado en las sucursales de Chile. Mostrar el número y hora de pago, importe pagado y el nombre del país.
-- Cantidad de registros devueltos (rows): 

-- 18. Listar los clientes que no tienen préstamos. Mostrar el apellido, nombre y email del cliente.
-- Cantidad de registros devueltos (rows): 

-- 19. Se desea conocer el mes y año en que se terminaría de pagar el préstamo número treinta a partir de la fecha de otorgamiento. Se debe mostrar el email del cliente, número de préstamo, fecha de otorgamiento, importe prestado, mes y año que correspondería a la última cuota (Ej. "agosto de 2021").
-- Cantidad de registros devueltos (rows): 

-- 20. Listar las ciudades (sin repetir) que tengan entre dos a cuatro cuentas bancarias. Se debe mostrar el país, ciudad y la cantidad de cuentas. Además, se debe ordenar por país y ciudad.
-- Cantidad de registros devueltos (rows): 
